# -*- coding: utf-8 -*-

import json

import requests

headers = {
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36',
    'referer': 'http://music.163.com/',
    'cookie' : '_iuqxldmzr_=32; _ntes_nnid=3456b16948b336a05538e963120d560f,1597476677887; _ntes_nuid=3456b16948b336a05538e963120d560f; WM_TID=u%2BE9yhjmerxBUQQVRRYqWufb7%2BF%2Bu4FE; WM_NI=7qVPWRW3R%2FSJXkIHpGGQliJiz6AYcd6Djj8T1lTcxPKuQ4vM8Obs4PtWrPPbPYwlRbFGE9u958MVIvgfLED5SeLAp9vc8wbgrMYmTdBo9eemjRocNVjCVWGXsfLLoLZPbmM%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6eeacf9218d87bfaad37497bc8bb3c54b838a8e84ae60b2b09ca3db3e9c87e582ec2af0fea7c3b92af5af9ab1d65a95ed9ed0d2429cb587a9f34d858fa48ac963baea8fbae270f69ca68bbb60f3b49c84fb5c89ab9fd5f547fc91ae94b75cb889beb1d36a9487b98dd16a86998bdaf833f7e883b7cc7ea5ba84a6c73f91bb84a2f333b6bdf898e16db293978ed77082b1f786e867aa8ea184cd5eaa9d9ab8c654b1ba84adee489a90ae8ed037e2a3; playerid=41225991; JSESSIONID-WYYY=E%2Bl%2B6dCbGopzYM0HMmF8qnv9X22lpMtsoD68hCX4SW%2F7%2Bc73xy7TDw0fwtF5Ml7NH52wZj%2FbfpKVnfvcs755G7eok2CEUogVKEzoT%2FKIKU%2BwneKm%5C6J6ibTVXrU0Mzb5W9xrX%2BHJMfqvZVqooSAPYYRHOoGX5Fjv07hAPo6hqsf%5CUhjd%3A1597495875799a'
    }

data = { 'params' : 'lrOZL9Hcfx5KzoU1joKzDsute4iHJQBJXNFF/SmMIYGgtefmLPB5TeR1hGhzYA6OUDshpuQPx5d830fchEVwTgz77cXXRx5DajLNfCzDuRNSpP68On4i1uTt5tmYM24jLL++BT4RqnTSKaEiqLDbjjvbXmcjOGLNtaCKLwcrhCfb54/EV1/zqk1zE8iyssn3plYc74nr8XfdtdyvLTlCRguK1CQK17R5jMBlrpglPg54+pHznJgTXEaj9LyFUyz4Za3Pu3Bx+PMLmaeqLhyOH3uf+iEcWLiIpW/3vFeHT8M=',
        ' encSecKey' : '136c949db620ba4ae917e730158c2c19076f79c5a39a8f4b34091065c1316906ac8a7a853d2211da653d04edfc83b811cba80872a4bca747c9ad568577422dd3c5e11b91ff37e5c9617fe4437d420f9dfe5d9786bf67f536768f81f17ef4c4c4c288ad865811c1a641799d02fb745f25d6bc4423fac8178d0bbfb14842e4f564'
        }

url = 'https://music.163.com/#/song?id=1327337964'

name_id = url.split('=')[1]

target = 'https://music.163.com/weapi/comment/resource/comments/get?csrf_token='

print(">>正在爬取歌曲评论...")
res = requests.post(target, headers, data)

print(res.text)
print(res.content)
with open('res.txt', 'w', encoding='utf-8') as file:
    file.write(res.text)

print(">>正在提取热评...")
comments_json = json.loads(res.text)

print(">>正在写入文件...")
hot_comments = comments_json['data']["hotComments"]
with open('hot_comments.txt', 'w', encoding='utf-8') as file:
    for each in hot_comments:
        file.write(each['user']['nickname'] + '：\n\n')
        file.write(each['content'] + '\n')
        file.write("---------------------------------------\n")
